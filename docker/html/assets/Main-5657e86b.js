import{j as oe,r as u,ag as f,o as n,c as v,V as a,P as o,a3 as se,T as _,U as S,F as q,O as N,S as m,n as Y,b as ge,a as s,a9 as ae,Q as ke,W as be,J as we,u as Fe,bh as Te,bf as Ce}from"./@vue-57ff52f9.js";import{u as Ne}from"./vue-clipboard3-adec9f65.js";import{u as ie,b as Ie}from"./vue-router-8555237b.js";import{_ as Se}from"./index-ebfb4caf.js";import"./clipboard-de925a1a.js";import"./APlayer-9c029590.js";import"./pinia-00fcc55c.js";import"./spark-md5-52dc0e70.js";import"./element-plus-61115a40.js";import"./lodash-es-36eb724a.js";import"./@vueuse-7d05ada6.js";import"./@element-plus-b7409ee9.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-0d8d1de0.js";import"./async-validator-10c6301d.js";import"./memoize-one-297ddbcb.js";import"./escape-html-a32e42c6.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-880a26aa.js";import"./vue-cookies-10167fa5.js";import"./@highlightjs-be8e8472.js";import"./highlight.js-c8ccfcef.js";import"./axios-4a70c6fc.js";import"./docx-preview-6b5e4251.js";import"./jszip-97c1c277.js";import"./xlsx-04f2268f.js";import"./vue-pdf-embed-c0d60ac6.js";import"./vue-68235e8f.js";import"./vue3-pdfjs-debe5ed4.js";import"./pdfjs-dist-b6840bcc.js";import"./dommatrix-6b05c112.js";import"./web-streams-polyfill-dc7eb50b.js";import"./dplayer-a768f587.js";const xe={all:{accept:"*"},video:{accept:".mp4,.avi,.rmvb,.mkv,.mov"},music:{accept:".mp3,.wav,.wma,.mp2,.flac,.midi,.ra,.ape,.aac,.cda"},image:{accept:".jpeg,.jpg,.png,.gif,.bmp,.dds,.psd,.pdt,.webp,.xmp,.svg,.tiff"},doc:{accept:".pdf,.doc,.docx,.xls,.xlsx,.txt"},others:{accept:"*"}},Re={__name:"ShareFile",setup($,{expose:A}){const{toClipboard:H}=Ne(),{proxy:r}=oe();ie();const O=u(document.location.origin+"/share/"),Z={shareFile:"/share/shareFile"},y=u(0),h=u({}),E=u(),j={validType:[{required:!0,message:"请选择有效期"}],codeType:[{required:!0,message:"请选择提取码类型"}],code:[{required:!0,message:"请输入提取码"},{validator:r.Verify.shareCode,message:"提取码只能是数字字母"},{min:5,message:"提取码最少5位"}]},c=u(!0),w=u({show:!1,title:"分享",buttons:[{type:"primary",text:"确定",click:b=>{Q()}}]}),d=u({}),Q=async()=>{if(Object.keys(d.value).length>0){w.value.show=!1;return}E.value.validate(async b=>{if(!b)return;let i={};Object.assign(i,h.value);let g=await r.Request({url:Z.shareFile,params:i});g&&(y.value=1,d.value=g.data,w.value.buttons[0].text="关闭",c.value=!1)})};A({show:b=>{c.value=!0,w.value.show=!0,y.value=0,d.value={},Y(()=>{E.value.resetFields(),h.value=Object.assign({},b)})}});const R=async()=>{await H(`链接:${O.value}${d.value.shareId} 提取码: ${d.value.code}`),r.Message.success("复制成功")};return(b,i)=>{const g=f("el-form-item"),C=f("el-radio"),F=f("el-radio-group"),J=f("el-input"),B=f("el-button"),W=f("el-form"),G=f("Dialog");return n(),v("div",null,[a(G,{show:w.value.show,title:w.value.title,buttons:w.value.buttons,width:"600px",showCancel:c.value,onClose:i[4]||(i[4]=T=>w.value.show=!1)},{default:o(()=>[a(W,{model:h.value,rules:j,ref_key:"formDataRef",ref:E,"label-width":"100px",onSubmit:i[3]||(i[3]=se(()=>{},["prevent"]))},{default:o(()=>[a(g,{label:"文件"},{default:o(()=>[_(S(h.value.fileName),1)]),_:1}),y.value==0?(n(),v(q,{key:0},[a(g,{label:"有效期",prop:"validType"},{default:o(()=>[a(F,{modelValue:h.value.validType,"onUpdate:modelValue":i[0]||(i[0]=T=>h.value.validType=T)},{default:o(()=>[a(C,{label:0},{default:o(()=>[_("1天")]),_:1}),a(C,{label:1},{default:o(()=>[_("7天")]),_:1}),a(C,{label:2},{default:o(()=>[_("30天")]),_:1}),a(C,{label:3},{default:o(()=>[_("永久有效")]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(g,{label:"提取码",prop:"codeType"},{default:o(()=>[a(F,{modelValue:h.value.codeType,"onUpdate:modelValue":i[1]||(i[1]=T=>h.value.codeType=T)},{default:o(()=>[a(C,{label:0},{default:o(()=>[_("自定义")]),_:1}),a(C,{label:1},{default:o(()=>[_("系统生成")]),_:1})]),_:1},8,["modelValue"])]),_:1}),h.value.codeType==0?(n(),N(g,{key:0,prop:"code"},{default:o(()=>[a(J,{clearable:"",placeholder:"请输入5位提取码",modelValue:h.value.code,"onUpdate:modelValue":i[2]||(i[2]=T=>h.value.code=T),modelModifiers:{trim:!0},maxLength:"5",style:{width:"130px"}},null,8,["modelValue"])]),_:1})):m("",!0)],64)):(n(),v(q,{key:1},[a(g,{label:"分享连接",prop:"validType"},{default:o(()=>[_(S(O.value)+S(d.value.shareId),1)]),_:1}),a(g,{label:"提取码",prop:"validType"},{default:o(()=>[_(S(d.value.code),1)]),_:1}),a(g,{prop:"validType"},{default:o(()=>[a(B,{type:"primary",onClick:R},{default:o(()=>[_("复制链接极提取码")]),_:1})]),_:1})],64))]),_:1},8,["model"])]),_:1},8,["show","title","buttons","showCancel"])])}}};const x=$=>(Te("data-v-e29906a7"),$=$(),Ce(),$),Ve={class:"top"},De={class:"top-op"},Me={class:"btn"},$e=x(()=>s("span",{class:"iconfont icon-upload"},null,-1)),Oe=x(()=>s("span",{class:"iconfont icon-folder-add"},null,-1)),Ee=x(()=>s("span",{class:"iconfont icon-del"},null,-1)),Je=x(()=>s("span",{class:"iconfont icon-move"},null,-1)),ze={class:"search-panel"},Pe={key:0,class:"file-list"},Ue=["onMouseenter","onMouseleave"],qe=["title"],je=["onClick"],Le={key:0,class:"transfer-status"},Be={key:1,class:"transfer-status transfer-fail"},Ke={class:"edit-panel"},Ae=["onClick"],He=["onClick"],Qe={class:"op"},We=["onClick"],Ge=["onClick"],Xe=["onClick"],Ye=["onClick"],Ze=["onClick"],el={key:0},ll={key:1,class:"no-data"},tl={class:"no-data-inner"},al=x(()=>s("div",{class:"tips"},"当前目录为空，上传你的第一个文件吧",-1)),ol={class:"op-list"},sl={class:"op-item"},il=x(()=>s("div",null,"上传文件",-1)),nl=x(()=>s("div",null,"新建目录",-1)),cl={__name:"Main",emits:["addFile"],setup($,{expose:A,emit:H}){const{proxy:r}=oe();ie(),Ie();const O=async e=>{H("addFile",{file:e.file,filePid:z.value.fileId})};A({reload:()=>{R.value=!1,i()}});const y={loadDataList:"/file/loadDataList",rename:"/file/rename",newFoloder:"/file/newFoloder",getFolderInfo:"/file/getFolderInfo",delFile:"/file/delFile",changeFileFolder:"/file/changeFileFolder",createDownloadUrl:"/file/createDownloadUrl",download:"/api/file/download"},h=ge(()=>{const e=xe[b.value];return e?e.accept:"*"}),E=[{label:"文件名",prop:"fileName",scopedSlots:"fileName"},{label:"修改时间",prop:"lastUpdateTime",width:200},{label:"大小",prop:"fileSize",scopedSlots:"fileSize",width:200}],j=()=>{R.value=!0,i()},c=u({}),w={extHeight:50,selectType:"checkbox"},d=u([]),Q=e=>{d.value=[],e.forEach(t=>{d.value.push(t.fileId)})},L=u(),R=u(!0),b=u(),i=async()=>{let e={pageNo:c.value.pageNo||"1",pageSize:c.value.pageSize||"15",fileNameFuzzy:L.value,category:b.value,filePid:z.value.fileId};e.category!=="all"&&delete e.filePid;let t=await r.Request({url:y.loadDataList,showLoading:R,params:e});if(t){c.value=t.data;for(let p=0;p<t.data.list.length;p++)if(t.data.list[p].status!=2){setTimeout(i,8e3);break}F.value=!1}},g=e=>{c.value.list.forEach(t=>{t.showOp=!1}),e.showOp=!0},C=e=>{e.showOp=!1},F=u(!1),J=u(),B=()=>{F.value||(c.value.list.forEach(e=>{e.showEdit=!1}),F.value=!0,c.value.list.unshift({showEdit:!0,fileType:0,fileId:"",filePid:z.value.fileId}),Y(()=>{J.value.focus()}))},W=e=>{c.value.list[0].fileId==""&&c.value.list.splice(0,1),c.value.list.forEach(p=>{p.showEdit=!1});let t=c.value.list[e];t.showEdit=!0,t.folderType==0?(t.fileNameReal=t.fileName.substring(0,t.fileName.indexOf(".")),t.fileSuffix=t.fileName.substring(t.fileName.indexOf("."))):(t.fileNameReal=t.fileName,t.fileSuffix=""),F.value=!0,Y(()=>{J.value.focus()})},G=e=>{const t=c.value.list[e];t.fileId?t.showEdit=!1:(c.value.list.splice(e,1),F.value=!1)},T=async e=>{const{fileId:t,filePid:p,fileNameReal:V}=c.value.list[e];if(V==""||V.indexOf("/")!=-1){r.Message.warning("文件名不能为空且不能含有斜杠");return}let U=y.rename;t==""&&(U=y.newFoloder);let D=await r.Request({url:U,params:{fileId:t,filePid:p,fileName:V}});D&&(c.value.list[e]=D.data,F.value=!1,D.code==200&&r.Message.success(D.data),i())},ee=u(),le=u(),ne=e=>{if(e.fengJing==1){r.Message.warning("文件违规，以封禁！");return}if(e.folderType==1&&e.fengJing==2){le.value.openFolder(e);return}if(e.status!=2){r.Message.warning("文件正在转码中，无法预览");return}console.log(JSON.stringify(e)),ee.value.showPreview(e,0)},z=u({fileId:0}),ce=e=>{const{curFolder:t,categoryId:p}=e;z.value=t,R.value=!0,b.value=p,i()},K=u(),P=u({}),ue=e=>{P.value=e,K.value.showFolderDialog(e.fileId)},re=()=>{P.value={},K.value.showFolderDialog(d.value.join(","))},de=async e=>{if(P.value.filePid===e||z.value.fileId==e){r.Message.warning("文件正在当前目录，无需移动");return}let t=[];P.value.fileId?t.push(P.value.fileId):t=t.concat(d.value),await r.Request({url:y.changeFileFolder,params:{fileIds:t.join(","),filePid:e}})&&(K.value.close(),i())},fe=e=>{r.Confirm(`你确定要删除【${e.fileName}】吗？删除的文件可在10天内通过回收站还原`,async()=>{await r.Request({url:y.delFile,params:{fileIds:e.fileId}})&&(i(),dataTableRef.value.clearSelection())})},pe=()=>{d.value.length!=0&&r.Confirm("你确定要删除这些文件吗？删除的文件可在10天内通过回收站还原",async()=>{await r.Request({url:y.delFile,params:{fileIds:d.value.join(",")}})&&i()})},me=async e=>{let t=await r.Request({url:y.createDownloadUrl+"/"+e.fileId});t&&(window.location.href=y.download+"/"+t.data)},te=u(),ve=e=>{te.value.show(e)};return(e,t)=>{const p=f("el-button"),V=f("el-upload"),U=f("el-input"),D=f("Navigation"),M=f("icon"),_e=f("Table"),X=f("Icon"),he=f("Preview"),ye=f("FolderSelect");return n(),v("div",null,[s("div",Ve,[s("div",De,[s("div",Me,[a(V,{"show-file-list":!1,"with-credentials":!0,multiple:!0,"http-request":O,accept:h.value},{default:o(()=>[a(p,{type:"primary"},{default:o(()=>[$e,_(" 上传 ")]),_:1})]),_:1},8,["accept"])]),b.value=="all"?(n(),N(p,{key:0,type:"success",onClick:B},{default:o(()=>[Oe,_(" 新建文件夹 ")]),_:1})):m("",!0),a(p,{onClick:pe,type:"danger",disabled:d.value.length==0},{default:o(()=>[Ee,_(" 批量删除 ")]),_:1},8,["disabled"]),a(p,{onClick:re,type:"warning",disabled:d.value.length==0},{default:o(()=>[Je,_(" 批量移动 ")]),_:1},8,["disabled"]),s("div",ze,[a(U,{clearable:"",placeholder:"输入文件名搜索",modelValue:L.value,"onUpdate:modelValue":t[0]||(t[0]=I=>L.value=I),onKeyup:ae(j,["enter"])},{suffix:o(()=>[s("i",{class:"iconfont icon-search",onClick:j})]),_:1},8,["modelValue","onKeyup"])]),s("div",{class:"iconfont icon-refresh",onClick:i})]),a(D,{ref_key:"navigationRef",ref:le,onNavChange:ce},null,512)]),c.value.list&&c.value.list.length>0?(n(),v("div",Pe,[a(_e,{ref:"dataTableRef",columns:E,showPagination:!0,dataSource:c.value,fetch:i,initFetch:!1,options:w,onRowSelected:Q},{fileName:o(({index:I,row:l})=>[s("div",{class:"file-item",onMouseenter:k=>g(l),onMouseleave:k=>C(l)},[(l.fileType==3||l.fileType==1)&&l.status==2?(n(),v(q,{key:0},[l.fengJing==2?(n(),N(M,{key:0,cover:l.fileCover,width:32,"save-sf":l.saveSf},null,8,["cover","save-sf"])):m("",!0),l.fengJing==1?(n(),N(M,{key:1,fileType:l.fengJing+10,width:32},null,8,["fileType"])):m("",!0)],64)):(n(),v(q,{key:1},[l.folderType==0&&l.fengJing==2?(n(),N(M,{key:0,fileType:l.fileType},null,8,["fileType"])):m("",!0),l.folderType==0&&l.fengJing==1?(n(),N(M,{key:1,fileType:l.fengJing+10},null,8,["fileType"])):m("",!0),l.folderType==1&&l.fengJing==2?(n(),N(M,{key:2,fileType:0})):m("",!0),l.folderType==1&&l.fengJing==1?(n(),N(M,{key:3,fileType:l.fengJing+10},null,8,["fileType"])):m("",!0)],64)),l.showEdit?m("",!0):(n(),v("span",{key:2,class:"file-name",title:l.fileName},[s("span",{onClick:k=>ne(l)},S(l.fileName),9,je),l.status==0?(n(),v("span",Le,"转码中")):m("",!0),l.status==1?(n(),v("span",Be,"转码失败")):m("",!0)],8,qe)),ke(s("div",Ke,[a(U,{modelValue:l.fileNameReal,"onUpdate:modelValue":k=>l.fileNameReal=k,modelModifiers:{trim:!0},ref_key:"editNameRef",ref:J,maxLength:190,onKeyup:ae(k=>T(I),["enter"])},{suffix:o(()=>[_(S(l.fileSuffix),1)]),_:2},1032,["modelValue","onUpdate:modelValue","onKeyup"]),s("span",{class:we(["iconfont icon-right1",l.fileNameReal?"":"not-allow"]),onClick:k=>T(I)},null,10,Ae),s("span",{class:"iconfont icon-error",onClick:k=>G(I)},null,8,He)],512),[[be,l.showEdit]]),s("span",Qe,[l.showOp&&l.fileId&&l.status==2&&l.fengJing==2?(n(),v(q,{key:0},[s("span",{class:"iconfont icon-share1",onClick:k=>ve(l)},"分享",8,We),l.folderType==0?(n(),v("span",{key:0,class:"iconfont icon-download",onClick:k=>me(l)},"下载",8,Ge)):m("",!0),s("span",{class:"iconfont icon-del",onClick:k=>fe(l)},"删除",8,Xe),s("span",{class:"iconfont icon-edit",onClick:se(k=>W(I),["stop"])},"重命名",8,Ye),s("span",{class:"iconfont icon-move",onClick:k=>ue(l)},"移动",8,Ze)],64)):m("",!0)])],40,Ue)]),fileSize:o(({index:I,row:l})=>[l.fileSize?(n(),v("span",el,S(Fe(r).Utils.sizeToStr(l.fileSize)),1)):m("",!0)]),_:1},8,["dataSource"])])):(n(),v("div",ll,[s("div",tl,[a(X,{iconName:"no_data",width:120,fit:"fill"}),al,s("div",ol,[a(V,{"show-file-list":!1,"with-credentials":!0,multiple:!0,"http-request":O,accept:h.value},{default:o(()=>[s("div",sl,[a(X,{iconName:"file",width:60}),il])]),_:1},8,["accept"]),b.value=="all"?(n(),v("div",{key:0,class:"op-item",onClick:B},[a(X,{iconName:"folder",width:60}),nl])):m("",!0)])])])),a(he,{ref_key:"previewRef",ref:ee},null,512),a(ye,{ref_key:"folderSelectRef",ref:K,onFolderSelect:de},null,512),a(Re,{ref_key:"shareRef",ref:te},null,512)])}}},Ll=Se(cl,[["__scopeId","data-v-e29906a7"]]);export{Ll as default};
