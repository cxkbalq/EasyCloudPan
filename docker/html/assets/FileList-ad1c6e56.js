import{j as B,r as c,ag as f,o as s,c as a,a as n,V as m,P as _,a9 as R,O as g,F as V,S as i,U as S,T as q,J as j,u as H}from"./@vue-57ff52f9.js";import{u as A,b as G}from"./vue-router-8555237b.js";import{_ as Q}from"./index-ebfb4caf.js";import"./pinia-00fcc55c.js";import"./spark-md5-52dc0e70.js";import"./APlayer-9c029590.js";import"./element-plus-61115a40.js";import"./lodash-es-36eb724a.js";import"./@vueuse-7d05ada6.js";import"./@element-plus-b7409ee9.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-0d8d1de0.js";import"./async-validator-10c6301d.js";import"./memoize-one-297ddbcb.js";import"./escape-html-a32e42c6.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-880a26aa.js";import"./vue-cookies-10167fa5.js";import"./@highlightjs-be8e8472.js";import"./highlight.js-c8ccfcef.js";import"./axios-4a70c6fc.js";import"./docx-preview-6b5e4251.js";import"./jszip-97c1c277.js";import"./xlsx-04f2268f.js";import"./vue-pdf-embed-c0d60ac6.js";import"./vue-68235e8f.js";import"./vue3-pdfjs-debe5ed4.js";import"./pdfjs-dist-b6840bcc.js";import"./dommatrix-6b05c112.js";import"./web-streams-polyfill-dc7eb50b.js";import"./dplayer-a768f587.js";import"./vue-clipboard3-adec9f65.js";import"./clipboard-de925a1a.js";const W={class:"top"},X={class:"top-op"},Y={class:"search-panel"},Z={class:"file-list"},ee=["onMouseenter","onMouseleave"],te=["title"],oe=["onClick"],se={key:0,class:"transfer-status"},ae={key:1,class:"transfer-status transfer-fail"},ie={key:3,class:"edit-panel"},ne=["onClick"],le=["onClick"],ce={class:"op"},re=["onClick"],pe=["onClick"],ue=["onClick"],de={key:0},fe={key:0,style:{color:"#529b2e"}},me={key:1,style:{color:"#f56c6c"}},_e={__name:"FileList",emits:["addFile"],setup(ve,{expose:x,emit:he}){const{proxy:p}=B();A(),G(),x({reload:()=>{h.value=!1,u()}});const v={loadDataList:"/admin/loadFileList",updateFileStatus:"/admin/updateFileStatus",createDownloadUrl:"/admin/createDownloadUrl",download:"/api/admin/download"},L=[{label:"文件名",prop:"fileName",scopedSlots:"fileName"},{label:"用户id",prop:"userId",width:200},{label:"状态",prop:"status",scopedSlots:"status",width:80},{label:"修改时间",prop:"lastUpdateTime",width:200},{label:"大小",prop:"fileSize",scopedSlots:"fileSize",width:200}],C=()=>{h.value=!0,u()},d=c({}),U={extHeight:50,selectType:"checkbox"},N=c([]),$=t=>{N.value=[],t.forEach(o=>{N.value.push(o.userId+"_"+o.fileId)})},y=c(),h=c(!0),u=async()=>{let t={pageNo:d.value.pageNo||1,pageSize:d.value.pageSize||15,fileNameFuzzy:y.value,filePid:T.value.fileId},o=await p.Request({url:v.loadDataList,showLoading:h,params:t});o&&(d.value=o.data)},w=t=>{d.value.list.forEach(o=>{o.showOp=!1}),t.showOp=!0},D=t=>{t.showOp=!1},I=c(),F=c(),E=t=>{if(t.folderType==1){F.value.openFolder(t);return}if(t.status!=2){p.Message.warning("文件正在转码中，无法预览");return}I.value.showPreview(t,1)},T=c({fileId:0}),O=t=>{const{curFolder:o}=t;T.value=o,h.value=!0,u()},b=t=>{p.Confirm(`你确定要【${t.fengJing==2?"禁用":"恢复"}】吗？`,async()=>{await p.Request({url:v.updateFileStatus,params:{userId:t.userId,status:t.fengJing==2?1:2,fileId:t.fileId}})&&u()})},J=async t=>{let o=await p.Request({url:v.createDownloadUrl+"/"+t.userId+"/"+t.fileId});o&&(window.location.href=v.download+"/"+o.data+"/"+t.userId)};return c(),(t,o)=>{const z=f("el-input"),M=f("Navigation"),k=f("icon"),P=f("Table"),K=f("Preview");return s(),a("div",null,[n("div",W,[n("div",X,[n("div",Y,[m(z,{clearable:"",placeholder:"输入文件名搜索",modelValue:y.value,"onUpdate:modelValue":o[0]||(o[0]=r=>y.value=r),onKeyup:R(C,["enter"])},{suffix:_(()=>[n("i",{class:"iconfont icon-search",onClick:C})]),_:1},8,["modelValue","onKeyup"])]),n("div",{class:"iconfont icon-refresh",onClick:u})]),m(M,{ref_key:"navigationRef",ref:F,onNavChange:O,adminShow:!0},null,512)]),n("div",Z,[m(P,{columns:L,showPagination:!0,dataSource:d.value,fetch:u,initFetch:!1,options:U,onRowSelected:$},{fileName:_(({index:r,row:e})=>[n("div",{class:"file-item",onMouseenter:l=>w(e),onMouseleave:l=>D(e)},[(e.fileType==3||e.fileType==1)&&e.status==2?(s(),g(k,{key:0,userId:e.userId,cover:e.fileCover,width:32},null,8,["userId","cover"])):(s(),a(V,{key:1},[e.folderType==0?(s(),g(k,{key:0,fileType:e.fileType},null,8,["fileType"])):i("",!0),e.folderType==1?(s(),g(k,{key:1,fileType:0})):i("",!0)],64)),e.showEdit?i("",!0):(s(),a("span",{key:2,class:"file-name",title:e.fileName},[n("span",{onClick:l=>E(e)},S(e.fileName),9,oe),e.status==0?(s(),a("span",se,"转码中")):i("",!0),e.status==1?(s(),a("span",ae,"转码失败")):i("",!0)],8,te)),e.showEdit?(s(),a("div",ie,[m(z,{modelValue:e.fileNameReal,"onUpdate:modelValue":l=>e.fileNameReal=l,modelModifiers:{trim:!0},maxLength:190,onKeyup:R(l=>t.saveNameEdit(r),["enter"])},{suffix:_(()=>[q(S(e.fileSuffix),1)]),_:2},1032,["modelValue","onUpdate:modelValue","onKeyup"]),n("span",{class:j(["iconfont icon-right1",e.fileNameReal?"":"not-allow"]),onClick:l=>t.saveNameEdit(r)},null,10,ne),n("span",{class:"iconfont icon-error",onClick:l=>t.cancelNameEdit(r)},null,8,le)])):i("",!0),n("span",ce,[e.showOp&&e.fileId?(s(),a(V,{key:0},[e.folderType==0?(s(),a("span",{key:0,class:"iconfont icon-download",onClick:l=>J(e)},"下载",8,re)):i("",!0),e.fengJing==2?(s(),a("span",{key:1,class:"iconfont icon-close",onClick:l=>b(e)}," 封禁 ",8,pe)):i("",!0),e.fengJing==1?(s(),a("span",{key:2,class:"iconfont icon-ok",onClick:l=>b(e)}," 解封 ",8,ue)):i("",!0)],64)):i("",!0)])],40,ee)]),fileSize:_(({index:r,row:e})=>[e.fileSize?(s(),a("span",de,S(H(p).Utils.sizeToStr(e.fileSize)),1)):i("",!0)]),status:_(({index:r,row:e})=>[e.fengJing==2?(s(),a("span",fe,"正常")):i("",!0),e.fengJing==1?(s(),a("span",me,"封禁中")):i("",!0)]),_:1},8,["dataSource"])]),m(K,{ref_key:"previewRef",ref:I},null,512)])}}},Ze=Q(_e,[["__scopeId","data-v-34065279"]]);export{Ze as default};
