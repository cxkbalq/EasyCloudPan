import{u as se,b as te}from"./vue-router-8555237b.js";import{_ as oe}from"./index-ebfb4caf.js";import{j as ae,r,ag as c,aq as ne,o as a,c as d,a as s,Q as le,F as P,V as _,U as v,O as m,P as I,u as M,T as O,S as y,bh as ie,bf as re}from"./@vue-57ff52f9.js";import"./pinia-00fcc55c.js";import"./spark-md5-52dc0e70.js";import"./APlayer-9c029590.js";import"./element-plus-61115a40.js";import"./lodash-es-36eb724a.js";import"./@vueuse-7d05ada6.js";import"./@element-plus-b7409ee9.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-0d8d1de0.js";import"./async-validator-10c6301d.js";import"./memoize-one-297ddbcb.js";import"./escape-html-a32e42c6.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-880a26aa.js";import"./vue-cookies-10167fa5.js";import"./@highlightjs-be8e8472.js";import"./highlight.js-c8ccfcef.js";import"./axios-4a70c6fc.js";import"./docx-preview-6b5e4251.js";import"./jszip-97c1c277.js";import"./xlsx-04f2268f.js";import"./vue-pdf-embed-c0d60ac6.js";import"./vue-68235e8f.js";import"./vue3-pdfjs-debe5ed4.js";import"./pdfjs-dist-b6840bcc.js";import"./dommatrix-6b05c112.js";import"./web-streams-polyfill-dc7eb50b.js";import"./dplayer-a768f587.js";import"./vue-clipboard3-adec9f65.js";import"./clipboard-de925a1a.js";const w=S=>(ie("data-v-43aafb03"),S=S(),re(),S),ce={class:"share"},de=w(()=>s("span",{class:"iconfont icon-pan"},null,-1)),pe=w(()=>s("span",{class:"name"},"Small云盘",-1)),ue=[de,pe],he={class:"share-body"},fe={key:0,class:"loading"},_e={class:"share-panel"},ve={class:"share-user-info"},me={class:"avatar"},ye={class:"share-info"},Se={class:"user-info"},ge={class:"nick-name"},ke={class:"share-time"},Ie={class:"file-name"},we={class:"share-op-btn"},be=w(()=>s("span",{class:"iconfont icon-cancel"},null,-1)),Ce=w(()=>s("span",{class:"iconfont icon-import"},null,-1)),Fe={class:"file-list"},Te=["onMouseenter","onMouseleave"],Ne=["title"],Re=["onClick"],xe={class:"op"},De=["onClick"],Pe=["onClick"],Me={key:0},Oe={__name:"Share",setup(S){const{proxy:n}=ae(),p=se(),b=te(),u={getShareLoginInfo:"/showShare/getShareLoginInfo",loadFileList:"/showShare/loadFileList",createDownloadUrl:"/showShare/createDownloadUrl",download:"/api/showShare/download",cancelShare:"/share/cancelShare",saveShare:"/showShare/saveShare"},i=b.params.shareId,l=r({});(async()=>{let e=await n.Request({url:u.getShareLoginInfo,showLoading:!1,params:{shareId:i}});if(e){if(e.data==null){p.push("/shareCheck/"+i);return}l.value=e.data}})();const U=[{label:"文件名",prop:"fileName",scopedSlots:"fileName"},{label:"过期时间",prop:"lastUpdateTime",width:200},{label:"大小",prop:"fileSize",scopedSlots:"fileSize",width:200}],h=r({}),z={extHeight:80,selectType:"checkbox"},C=async()=>{let e={pageNo:h.value.pageNo||"1",pageSize:h.value.pageSize||"15",shareId:i,filePid:N.value.fileId},o=await n.Request({url:u.loadFileList,params:e});if(o){if(o.info==="验证码错误"){p.push("/shareCheck/"+i);return}h.value=o.data}},L=e=>{h.value.list.forEach(o=>{o.showOp=!1}),e.showOp=!0},V=e=>{e.showOp=!1},f=r([]),q=e=>{f.value=[],e.forEach(o=>{f.value.push(o.fileId)})},N=r({fileId:0}),j=e=>{const{curFolder:o}=e;N.value=o,C()},R=r(),x=r(),$=e=>{if(e.folderType==1){x.value.openFolder(e);return}e.shareId=i,R.value.showPreview(e,2)},B=async e=>{let o=await n.Request({url:u.createDownloadUrl+"/"+i+"/"+e});o&&(window.location.href=u.download+"/"+o.data)},g=r(),F=[],A=()=>{if(f.value.length!=0){if(!n.VueCookies.get("userInfo")){p.push("/login?redirectUrl="+b.path);return}F.values=f.value,g.value.showFolderDialog()}},E=e=>{if(!n.VueCookies.get("userInfo")){p.push("/login?redirectUrl="+b.path);return}F.values=[e.fileId],g.value.showFolderDialog()},H=async e=>{await n.Request({url:u.saveShare,params:{shareId:i,shareFileIds:F.values.join(","),myFolderId:e}})&&(C(),n.Message.success("保存成功"),g.value.close())},Q=()=>{n.Confirm("你确定要取消分享吗？",async()=>{await n.Request({url:u.cancelShare,params:{shareIds:i}})&&(n.Message.success("取消分享成功"),p.push("/"))})},G=()=>{p.push("/")};return(e,o)=>{const J=c("Avatar"),D=c("el-button"),K=c("Navigation"),T=c("icon"),W=c("Table"),X=c("FolderSelect"),Y=c("Preview"),Z=ne("loading");return a(),d("div",ce,[s("div",{class:"header"},[s("div",{class:"header-content"},[s("div",{class:"logo",onClick:G},ue)])]),s("div",he,[Object.keys(l.value).length==0?le((a(),d("div",fe,null,512)),[[Z,Object.keys(l.value).length==0]]):(a(),d(P,{key:1},[s("div",_e,[s("div",ve,[s("div",me,[_(J,{userId:l.value.userId,avatar:l.value.avatar,width:50},null,8,["userId","avatar"])]),s("div",ye,[s("div",Se,[s("span",ge,v(l.value.nickName),1),s("span",ke,"分享于 "+v(l.value.shareTime),1)]),s("div",Ie,"分享文件："+v(l.value.fileName),1)])]),s("div",we,[l.value.currentUser?(a(),m(D,{key:0,type:"primary",onClick:Q},{default:I(()=>[be,O("取消分享")]),_:1})):(a(),m(D,{key:1,type:"primary",disabled:f.value.length==0,onClick:A},{default:I(()=>[Ce,O("保存到我的网盘")]),_:1},8,["disabled"]))])]),_(K,{ref_key:"navigationRef",ref:x,onNavChange:j,shareId:M(i)},null,8,["shareId"]),s("div",Fe,[_(W,{columns:U,showPagination:!0,dataSource:h.value,fetch:C,initFetch:!1,options:z,showPageSize:!1,onRowSelected:q},{fileName:I(({index:ee,row:t})=>[s("div",{class:"file-item",onMouseenter:k=>L(t),onMouseleave:k=>V(t)},[(t.fileType==3||t.fileType==1)&&t.status!==0?(a(),m(T,{key:0,cover:t.fileCover,"user-id":t.userId,type:!0},null,8,["cover","user-id"])):(a(),d(P,{key:1},[t.folderType==0?(a(),m(T,{key:0,fileType:t.fileType},null,8,["fileType"])):y("",!0),t.folderType==1?(a(),m(T,{key:1,fileType:0})):y("",!0)],64)),s("span",{class:"file-name",title:t.fileName},[s("span",{onClick:k=>$(t)},v(t.fileName),9,Re)],8,Ne),s("span",xe,[t.folderType==0?(a(),d("span",{key:0,class:"iconfont icon-download",onClick:k=>B(t.fileId)},"下载",8,De)):y("",!0),t.showOp&&!l.value.currentUser?(a(),d("span",{key:1,class:"iconfont icon-import",onClick:k=>E(t)},"保存到我的网盘",8,Pe)):y("",!0)])],40,Te)]),fileSize:I(({index:ee,row:t})=>[t.fileSize?(a(),d("span",Me,v(M(n).Utils.sizeToStr(t.fileSize)),1)):y("",!0)]),_:1},8,["dataSource"])])],64)),_(X,{ref_key:"folderSelectRef",ref:g,onFolderSelect:H},null,512),_(Y,{ref_key:"previewRef",ref:R},null,512)])])}}},vs=oe(Oe,[["__scopeId","data-v-43aafb03"]]);export{vs as default};
